<!DOCTYPE html>
<link lang="en">
  <link>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="style.css"></link>
  </head>
  <body>
    <form id="table-form" >
      <label for="fname">First Name:</label>
      <input
        id="fname"
        type="text"
        placeholder="Enter First Name"
        name="fname"
      /><br /><br>
      <label for="tech">Technology:</label>
      <input
        type="text"
        placeholder="Enter Technology"
        id="tech"
        name="tech"
      /><br /><br >
      <input type="submit" id="btn_add" value="Add data" />
      <button id="btn_update">Update Data</button>
    </form>
    <script>
       let form = document.getElementById("btn_add");
       form.addEventListener("click",  () => {
        // e.preventDefault()
         let url ="http://localhost:3000/table" ;
       
        //  let formData = new FormData(form);
           
        //  let formDataObject = Object.fromEntries(formData.entries());

        //  let formDataJsonString = JSON.stringify(formDataObject);
        //  console.log(formDataJsonString);
        
        let fName=document.getElementById("fname").value;
        let technology=document.getElementById("tech").value;
        console.log(fName);

         let fetchOptions = {
         method: "POST",

         headers: {
            "Content-Type": "application/json",
          },

          // body: formDataJsonString,
          body: JSON.stringify({fname:fName,tech:technology})
        }
        console.log(fetchOptions);
     
      fetch(url, fetchOptions).then((Response) => Response.json())
     .then(data => data)
     .catch(error => console.error());
       }); 

      //  table object 

      const header={"id":"ID",
      "fname":"FIRST NAME",
      "tech":"TECHNOLOGY",
    };
    // table header 
      let table=document.createElement("table");
      table.className="table";
      console.log(table);
      function thead(table,header)
         {
             let thead=table.createTHead();
            //  thead.className='emp-th';
             table.appendChild(thead);
             
            let trow=thead.insertRow();
            // trow.className='emp-th'
            thead.appendChild(trow)
            for (const key in header) {
               let th=document.createElement("th");
                th.className='emp-th';
               
               let text=document.createTextNode(header[key]);
               th.appendChild(text);
               trow.appendChild(th);
            }
            let th=document.createElement("th")
            th.className='emp-th';
            let text=document.createTextNode("ACTION"); 
            th.appendChild(text);
            trow.appendChild(th);
         }
         thead(table,header);
// table body
  window.addEventListener('load',fetch('http://localhost:3000/table')
        .then((response) => response.json() ) 
        .then( data => {
          
            let tbody=table.createTBody();
            for (const element of  data) {
              console.log(element);
              let tr=document.createElement("tr");
              tr.className='emp-tr'
              tbody.appendChild(tr);
              for (const key in header) {
                let td=document.createElement("td");
                td.className='emp-td'
                let text1=document.createTextNode(element[key]);
                console.log(header.id);
                // console.log(element[]);
                td.appendChild(text1);
                tr.appendChild(td);

              }
               let td2=document.createElement("td")
               let deleteButton=document.createElement("button")
               let text2=document.createTextNode("Delete");
               deleteButton.appendChild(text2);
               deleteButton.className='click-btn'
               deleteButton.addEventListener("click",(event)=>{fetch(`http://localhost:3000/table/${element.id}`,{
                method:"DELETE"
               }).catch(Error=>console.error())
               table.deleteRow(tr.rowIndex)
              })
               td2.appendChild(deleteButton);
               tr.appendChild(td2);
               let editButton=document.createElement("button")
               let text3=document.createTextNode("Edit");
               editButton.appendChild(text3)
               editButton.className='click-btn'
               editButton.addEventListener('click',(event) => {
                document.getElementById('fname').value=element.fname;
                document.getElementById('tech').value=element.tech;
                let updateButton=document.getElementById('btn_update')
                updateButton.addEventListener('click',(event) => {
                  fetch(`http://localhost:3000/table/${element.id}`,
                  {
                    method:'PUT',
                    headers: {
                    "Content-Type": "application/json",
                    },
                    body:JSON.stringify({fname:document.getElementById('fname').value,tech:document.getElementById("tech").value})



                  }).catch(Error=>console.error())
                })


               })
               td2.appendChild(editButton);




              //  let td3=document.createElement("td")
              //  let editButton=document.createElement("button")
              //  let text3=document.createTextNode("edit");
              //  editButton.appendChild(text3);
              //  td2.appendChild(editButton);
              //  tr.appendChild(td3);
                //  let tr=document.createElement("tr");
                //  tbody.appendChild(tr);
                
                //  let cell1=document.createElement("td");
                //  let text1=document.createTextNode(element["id"]);
                //  cell1.appendChild(text1);
                //  tr.appendChild(cell1);

                //  let cell2=document.createElement("td");
                //  let text2=document.createTextNode(element["fname"]);
                //  cell2.appendChild(text2);
                //  tr.appendChild(cell2);

                //  let cell3=document.createElement("td");
                //  let text3=document.createTextNode(element["tech"]);
                //  cell3.appendChild(text3);
                //  tr.appendChild(cell3)
                 
                //  let cell4=document.createElement("td");
                //  let delete_btn=document.createElement("button");
                //  let text5=document.createTextNode("Delete");
                //  delete_btn.appendChild(text5);
                //  delete_btn.addEventListener("click",
                //  (event)=>{
                //  fetch(`http://localhost:3000/table/${element.id}`,{
                //   method:'DELETE'
                //  }).catch(error=> console.error())
                //  table.deleteRow(tr.rowIndex)


                // }
                //  )

                //  let cell5=document.createElement("td");
                //  let edit_btn=document.createElement("button");
                //  let text6 =document.createTextNode("Edit");
                //  edit_btn.appendChild(text6);
                //  edit_btn.addEventListener('click',(event) => {
                //   document.getElementById("fname").value=element.fname;
                //   document.getElementById("tech").value=element.tech;
                //     sessionStorage.setItem("id",JSON.stringify(element.id));
                //   let updateButton=document.getElementById("btn_update");

                //   updateButton.addEventListener("click",(event) => {                    
                //    fetch(`http://localhost:3000/table/${element.id}`,{
                //      method:'PUT',
                //      headers: {
                //     "Content-Type": "application/json",
                //     },

                //      body:JSON.stringify({fname:document.getElementById("fname").value
                //      ,tech:document.getElementById("tech").value
                //     })
                //     }).catch(error=>console.log(error));
                //  }
                //  )
                // }
                //  )
                //  cell4.appendChild(delete_btn);
                //  cell5.appendChild(edit_btn);
                //  tr.appendChild(cell4);
                //  tr.appendChild(cell5);
                // tbody.appendChild(tr);
                  

            }
        })
        .catch(error => console.error(error)));
          
        // console.log(getData);

        // let diya = localStorage.getItem("data");
        // // console.log(diya);
        // let diyaben = JSON.parse(diya);
        

        //  function tbody(table,header)
        //   {
        //     let tbody=table.createTBody();
        //     for (const iterator of  header) {
        //       let brow=tbody.insertRow();
              
        //       for (const key in iterator) {
        //         let td=brow.insertCell();
        //         let text1 = document.createTextNode(iterator[key]) ;
        //         td.appendChild(text1); 
        //       }
        //     }
        //    }
        //  tbody(table,diyaben);
           let body= document.querySelector("body");
           body.appendChild(table)
    </script>
  </body>
</html>
