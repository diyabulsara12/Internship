<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <form id="table-form" >
      <label for="fname">First Name:</label>
      <input
        id="fname"
        type="text"
        placeholder="Enter First Name"
        name="fname"
      /><br /><br>
      <label for="tech">Technology:</label>
      <input
        type="text"
        placeholder="Enter Technology"
        id="tech"
        name="tech"
      /><br /><br >
      <input type="submit" id="btn_add" value="Add data" />
      <button id="btn_update">Update Data</button>
    </form>
    <script>
       let form = document.getElementById("btn_add");
       form.addEventListener("click",  () => {
        // e.preventDefault()
         let url ="http://localhost:3000/table" ;
       
        //  let formData = new FormData(form);
           
        //  let formDataObject = Object.fromEntries(formData.entries());

        //  let formDataJsonString = JSON.stringify(formDataObject);
        //  console.log(formDataJsonString);
        
        let fName=document.getElementById("fname").value;
        let technology=document.getElementById("tech").value;
        console.log(fName);

         let fetchOptions = {
         method: "POST",

         headers: {
            "Content-Type": "application/json",
          },

          // body: formDataJsonString,
          body: JSON.stringify({fname:fName,tech:technology})
        }
        console.log(fetchOptions);
     
      fetch(url, fetchOptions).then((Response) => Response.json())
     .then(data => data)
     .catch(error => console.error());
       }); 

      const header={"id":"ID",
      "fname":"FIRST NAME",
      "tech":"TECHNOLOGY",
      "Action":"ACTION"};
      let table=document.createElement("table");
      console.log(table);
      function thead(table,header)
         {
             let thead=table.createTHead();
             table.appendChild(thead);
             
            let trow=thead.insertRow();
            thead.appendChild(trow)
            for (const key in header) {
               let th=document.createElement("th");
               
               let text=document.createTextNode(header[key]);
               th.appendChild(text);
               trow.appendChild(th);
            }
         }
         thead(table,header);

  window.addEventListener('load',fetch('http://localhost:3000/table')
        .then((response) => response.json() ) 
        .then( data => {
          
            let tbody=table.createTBody();
            for (const element of  data) {
                 let tr=document.createElement("tr");
                
                 let cell1=document.createElement("td");
                 let text1=document.createTextNode(element["id"]);
                 cell1.appendChild(text1);
                 tr.appendChild(cell1);

                 let cell2=document.createElement("td");
                 let text2=document.createTextNode(element["fname"]);
                 cell2.appendChild(text2);
                 tr.appendChild(cell2);

                 let cell3=document.createElement("td");
                 let text3=document.createTextNode(element["tech"]);
                 cell3.appendChild(text3);
                 tr.appendChild(cell3)
                 
                 let cell4=document.createElement("td");
                 let delete_btn=document.createElement("button");
                 let text5=document.createTextNode("Delete");
                 delete_btn.appendChild(text5);
                 delete_btn.addEventListener("click",
                 (event)=>{
                 fetch(`http://localhost:3000/table/${element.id}`,{
                  method:'DELETE'
                 }).catch(error=> console.error())
                 table.deleteRow(tr.rowIndex)


                }
                 )

                 let cell5=document.createElement("td");
                 let edit_btn=document.createElement("button");
                 let text6 =document.createTextNode("Edit");
                 edit_btn.appendChild(text6);
                 edit_btn.addEventListener('click',(event) => {
                  document.getElementById("fname").value=element.fname;
                  document.getElementById("tech").value=element.tech;
                    sessionStorage.setItem("id",JSON.stringify(element.id));
                  let updateButton=document.getElementById("btn_update");

                  updateButton.addEventListener("click",(event) => {                    
                   fetch(`http://localhost:3000/table/${element.id}`,{
                     method:'PUT',
                     headers: {
                    "Content-Type": "application/json",
                    },

                     body:JSON.stringify({fname:document.getElementById("fname").value
                     ,tech:document.getElementById("tech").value
                    })
                    }).catch(error=>console.log(error));
                 }
                 )
                }
                 )
                 cell4.appendChild(delete_btn);
                 cell5.appendChild(edit_btn);
                 tr.appendChild(cell4);
                 tr.appendChild(cell5);
                tbody.appendChild(tr);
                  


                //  let cell4=document.createElement("td");
                //  let delete_btn=document.createElement("button");
                //  let text5=document.createTextNode("Delete");
                //  delete_btn.appendChild(text5);

                //  let cell5=document.createElement("td");
                //  let edit_btn=document.createElement("button");
                //  let text6 =document.createTextNode("Edit");
                //  edit_btn.appendChild(text6);
                //  delete_btn.appendChild(text6);
                //  cell4.appendChild(delete_btn);
                //  cell5.appendChild(edit_btn);
                //  tr.appendChild(cell4);
                //  tr.appendChild(cell5);
                //   tbody.appendChild(tr);

            }
        })
        .catch(error => console.error(error)));
          
        // console.log(getData);

        // let diya = localStorage.getItem("data");
        // // console.log(diya);
        // let diyaben = JSON.parse(diya);
        

        //  function tbody(table,header)
        //   {
        //     let tbody=table.createTBody();
        //     for (const iterator of  header) {
        //       let brow=tbody.insertRow();
              
        //       for (const key in iterator) {
        //         let td=brow.insertCell();
        //         let text1 = document.createTextNode(iterator[key]) ;
        //         td.appendChild(text1); 
        //       }
        //     }
        //    }
        //  tbody(table,diyaben);
           let body= document.querySelector("body");
           body.appendChild(table)
    </script>
  </body>
</html>
